<!doctype html>
<html>
<head>
  <title>ChatApp in Socket.io</title>
 <link rel="stylesheet" type="text/css" href="css/main.css">


  </head>
  <body>
    <h2 style="text-align:center;">Welcome to my Chat App</h2>
    <h3 id="socketName" style="text-align:center;"></h3>

    <div id="chatBody">
      <div id="totalusers"><span id="total">Total 0 users connected !</span>&nbsp &nbsp<button id="usersButton" role="button">Show People online</button> </div>
      <ul id="usersList"></ul>
      <ul id="messages"></ul>
      <div id="notify"></div>
      <form action="">
        <input placeholder="Enter your message here..." id="m" autocomplete="off" /><button>Send</button>
      </form>
    </div>
    <script src="/socket.io/socket.io.js"></script>

    <script src="/js/jquery-2.2.1.min.js"></script>

   
    <script>
var socketName="";
      $(document).ready(function(){
        $('#usersList').hide();

         $('#m').focus();
          $('#m').on('focus',function(){
           $('title').text("ChatApp in Socket.io");
          });

          $('body').on('click',function(){
           $('#m').focus();
          });
        var socket = io();
   socket.emit('adduser', prompt("What's your name?"));   ///asking for username
   $('form').submit(function(){
    
    socket.emit('chat message', String($('#m').val()));
    $('#m').val('');
    
    return false;
  
  });
   socket.on('chat message', function(username,msg,align,time){
    var myDate = new Date(time);
    
    var localTime = myDate.toLocaleString();
    console.log(localTime);
    var localTimeString=  localTime.slice(10,15)+" " +localTime.slice(18,21);
    if(align===150){
    $('#messages').append($('<li style="background:#B3E6DA;margin-left:'+align+'px;">').html("<div><b>"+username
                        +" : </b><div><div class='msg' style='text-align:left;padding-top:5px;padding-bottom:5px;'>" 
                        +" " +"</div><div class='msgtime'>"+localTimeString+"</div><span class='arrow-right'></span>")); 
    
    $('#messages > li:last').find('.msg').text(msg);
    $('title').text("ChatApp in Socket.io");
  }
  else{
    $('#messages').append($('<li style="background:#BDE4AF;margin-left:'+align+'px;">').html("<div><b>"+username
                        +" : </b><div><div class='msg' style='text-align:left;padding-top:5px;padding-bottom:5px;'>" 
                        +msg+"</div><div class='msgtime'>"+localTimeString+"</div><span class='arrow-left'></span>"));
    $('#messages > li:last').find('.msg').text(msg);
    $('title').text(username+" sent a message").css('color','red');
  }
    $('#messages').animate({
      scrollTop: $('#messages').get(0).scrollHeight
    }, 1);
    
  });
   socket.on('connected', function(msg){
     $('#messages').append($('<li style="margin-left:10px;color:blue;">').text(msg));
    
  });
   socket.on('totalusers', function(usernames,msg,username){
    $('#usersList').text('');
//    socketName=username;
    //$("#socketName").text("Your Name - "+socketName);
    for(var x=0;x<usernames.length;x++){
//      if(usernames[x]===socketName){
//        $('#usersList').append($('<li style="margin-left:10px;width=100px;color:red;">').text("You - "+usernames[x]));
//      }
//      else{
      $('#usersList').append($('<li style="margin-left:10px;width=100px;color:blue;"><a href="/private/'+socketName+'/'+usernames[x]+'">'+usernames[x]+' - Online</a>'));
//    }
    } 
    $('#total').text(msg);
    
  });
   socket.on('disconnected', function(msg){
    $('#messages').append($('<li style=" margin-left:10px; color:blue;">').text(msg));
    
  });
   var userVisability='hidden';
   $('#usersButton').on('click',function(){
    console.log("clicked!");
    if(userVisability==='showing'){
      $('#usersList').stop().hide(500);
      $('#usersButton').text("Show people Online");
      userVisability='hidden';
    }
    else if(userVisability==='hidden'){
      $('#usersList').stop().show(500);
      $('#usersButton').text("Hide people Online");
      userVisability='showing';
    }
  });
 });
</script>
</body>
</html>
